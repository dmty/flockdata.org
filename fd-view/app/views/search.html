<!--
  ~
  ~  Copyright (c) 2012-2016 "FlockData LLC"
  ~
  ~  This file is part of FlockData.
  ~
  ~  FlockData is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  FlockData is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with FlockData.  If not, see <http://www.gnu.org/licenses/>.
  -->

<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Search
    <small>database entities</small>
  </h1>
  <ol class="breadcrumb">
    <li><a ui-sref="welcome"><i class="ion-home"></i> Home</a></li>
    <li class="active">Search</li>
  </ol>
</section>

<!-- Main content -->
<section class="content">
  <div class="col-md-10">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Search documents</h3>
        <div class="box-tools pull-right">
          <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
        </div><!-- /.box-tools -->
      </div><!-- /.box-header -->
      <form role="form" ng-submit="search(searchText,company,fortress,types)">
        <div class="box-body">
          <div class="alert alert-warning fade in" ng-show="msg">
            {{msg}}
          </div>

          <div class="form-group">
            <input class="form-control" type="text" placeholder="Search..." ng-model="$root.searchText" autofocus/>
          </div>
          <br>
          <div class="col-md-6">
            <div class="form-group">
              <label for="fortress">Fortress</label>
              <input id="fortress" class="form-control" type="text" placeholder="Fortress" ng-model="fortress"/>
            </div>
          </div>
          <div class="col-md-6">
            <label for="types">Types</label>
            <tags-input id="types" type="text" placeholder="Types..." ng-model="types"></tags-input>
          </div>
        </div><!-- /.box-body -->
        <div class="box-footer">
          <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i>Search
          </button>
        </div>
      </form>
    </div><!-- /.box -->
  </div>

  <div class="col-md-12" ng-if="searchResults.length !=0">
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title">Search Results</h3>
        <div class="box-tools pull-right">
          <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div><!-- /.box-tools -->
      </div><!-- /.box-header -->
      <div class="box-body">
        <div class="well well-sm">
          <ul class="timeline">
            <li ng-repeat="searchResult in searchResults">
              <i class="fa fa-file-text"></i>
              <div class="timeline-item">
                <span class="time"><i class="fa fa-clock-o"></i> {{searchResult.whenCreated | amDateFormat:'ddd, MMM Do YYYY, hh:mm'}} </span>

                <h3 class="timeline-header">{{searchResult.description}} ({{searchResult.createdBy}})</h3>

                <div>
                  <small>
                    <span ng-repeat="resource in searchResult.resources track by $index" title="{{resource.key}}">
                      <span ng-repeat="value in resource.value track by $index">
                        <span ng-bind-html="value" class="search-resources"></span> ...
                      </span>
                    </span>
                  </small>
                </div>


                <div class="well well-sm display-inline fd-entityKey-elements">
                  <button class="btn btn-xs btn-default">{{searchResult.event}}</button>
                  <button class="btn btn-xs btn-default"
                          ng-click="openDetailsView(searchResult.key)">
                    {{searchResult.key}}</button>
                  <button class="btn btn-xs btn-default">{{searchResult.fortress}}</button>
                  <button class="btn btn-xs btn-default">{{searchResult.documentType}}</button>
                  <button class="btn btn-xs btn-default"
                          ng-if="searchResult.code != null">
                      {{searchResult.code}}</button>
                </div>
                <a ng-click="openGraphExplorer(searchResult.key)"
                   class="btn btn-xs btn-primary"><i class="fa fa-empire"></i
                        > Explore</a>

                <a ng-click="findLogs(searchResult.key, $index)"
                   ng-if="!searchResult.seeLogsAction" class="btn btn-xs btn-primary"><i class="fa fa-angle-double-down"></i> Changes</a>

                <a ng-click="findLogs(searchResult.key, $index)"
                   ng-if="searchResult.seeLogsAction" class="btn btn-xs btn-primary"><i class="fa fa-angle-double-down"></i> Changes</a>

                <p ng-if="searchResult.lastUpdate != null">
                    <!-- ToDo - format the date to the users Locale, not hard coded-->
                    <small>Last update at <em>{{searchResult.lastUpdate |
                        amDateFormat:'dddd, MMMM Do YYYY, h:mm:ss a'}}</em> by <em>{{searchResult.lastUser}}</em>
                    </small>
                </p>

                <div class="box-body smart-form slide in" ng-if="searchResult.seeLogsAction">
                  <!-- content goes here -->
                  <h5 class="todo-group-title"><i class="fa fa-list"></i> Logs</h5>
                  <ul class="todo ui-sortable fd-logs">
                    <li ng-repeat="logsResult in searchResult.logs">
                      <span class="handle">
                        <label class="checkbox">
                          <input type="checkbox" ng-click="selectLog(logsResult.id)" name="checkbox-inline">
                            <i></i>
                        </label>
                      </span>
                      <p>
                        <strong>{{logsResult.log.event.name}}</strong> -
                        {{logsResult.log.comment}}
                        <small>By {{logsResult.log.who.name}}</small>
                        [<a ng-click="openPopup(logsResult.id)" class="font-xs">More
                        Details</a>] <span class="date">{{logsResult.fortressWhen | amDateFormat:'dddd, MMMM Do YYYY, h:mm:ss a'}}</span>
                      </p>
                    </li>
                  </ul>
                  <a class="btn btn-xs btn-primary" ng-if="selectedLog.length === 2"
                     ng-click="openDeltaPopup()"><i class="fa fa-indent"></i> Compare Logs</a>
                  <!-- end content -->
                </div>
              </div>
            </li>
            <li class="text-center">
              <a href="javascript:void(0)" class="btn btn-sm btn-default"><i
                  class="fa fa-arrow-down text-muted"></i> LOAD MORE</a>
            </li>
          </ul>
        </div>
      </div><!-- /.box-body -->
    </div><!-- /.box -->
  </div>
</section>
<!-- /.content -->

<ng-flockdeltapopup></ng-flockdeltapopup>
<ng-flocksinglelogpopup></ng-flocksinglelogpopup>

#  proxy:
#    container_name: nginx
#    image: nginx:mainline-alpine
#    ports:
#        - "80:80"

rabbit:
  image: rabbitmq:3-management

# Uncomment ports for non-proxy debug
#  ports:
#    - '5672:5672'
#    - '15672:15672'

  expose:
    - 5672
    - 15672

fdengine:
  image: flockdata/fd-engine
  command: "-ea -Xmx768m "

  links:
     - rabbit
     - fdsearch
     - fdstore

# Uncomment ports for non-proxy debug
#  ports:
#    - '8090:8090'
#    - '61000:61000'

#  To debug the service, you MUST uncomment the debug line in the DockerFile for fd-engine
  expose:
    - 8090
    - 61000

  environment:

    server.port: 8090
    org.fd.engine.fortress.search: 'true'
    org.fd.engine.fortress.store: 'true'
    org.fd.engine.system.storage: memory
    org.fd.engine.search.update: 'true'
    org.fd.search.api: http://fdsearch:8091
    org.fd.store.api: http://fdstore:8092
    logging.level.org.flockdata: DEBUG
    # Disable the webserver
    org.neo4j.server.webserver.port: -1
    spring.jackson.serialization.indent_output: 'true'
    rabbit.host: rabbit
    rabbit.port: 5672

fdsearch:
  image: flockdata/fd-search
  command: "-Xmx768m"
  links:
    - rabbit
# Uncomment ports for non-proxy debug
#  ports:
#    - '8091:8091'
#    - '61001:61001'

  expose:
    - 8091
    - 61001

  environment:
    server.port: 8091
    org.fd.engine.url: 'http://fdengine:8090'
    # Enables integration functionality
    org.fd.engine.api: http://fdengine:8090
    #Is the node going to be a client node which means it will hold no data
    org.fd.search.es.transportOnly: "false"
    # A local node is a node that uses a local (JVM level) discovery and transport
    org.fd.search.es.local: "true"
    spring.jackson.serialization.indent_output: 'true'

    es.clustername: 'es_int_fd'
    es.path.home: /opt/flockdata
    es.path.data: /opt/flockdata/data

    rabbit.host: rabbit
    rabbit.port: 5672


fdstore:
  image: flockdata/fd-store
  command: "-Xmx768m"
  links:
     - rabbit

# Uncomment ports for non-proxy debug
#  ports:
#    - '8092:8092'
#    - '61002:61002'

  expose:
    - 8092
    - 61002

  environment:
    server.port: 8092
    spring.jackson.serialization.indent_output: 'true'
    spring.profiles.active: fd-no-auth,memstore
    rabbit.host: rabbit
    rabbit.port: 5672

#fdriak:
#  image: lapax/riak:latest
#  ports:
#    - '8087:8087'
#  environment:
#    storage_backend: leveldb
